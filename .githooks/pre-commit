#!/bin/bash

# Pre-commit hook for Go project quality control
set -e

echo "ğŸ” Running pre-commit checks..."

# 1. Go mod tidy
echo "ğŸ“¦ Running go mod tidy..."
go mod tidy

# 2. Format code
echo "ğŸ¨ Formatting code..."
go fmt ./...

# 3. Run golangci-lint (disable staticcheck for now due to false positive)
echo "ğŸ” Running golangci-lint..."
if command -v golangci-lint >/dev/null 2>&1; then
    golangci-lint run --disable=staticcheck
else
    echo "âš ï¸  golangci-lint not found, skipping lint check"
fi

# 4. Run unit tests
echo "ğŸ§ª Running unit tests..."
make test-unit

echo "âœ… All pre-commit checks passed!"